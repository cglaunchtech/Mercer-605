<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Search Web Application</title>
    <link rel="stylesheet" href="static/styles.css">
</head>
<body>
<section class="banner" id="banner">
    <div class="banner-head">ERD</div>
    <img src="static/images/ERD.png" class="erd">
    <div class="content">
        <h2>Bike Store ERD</h2>
        <p>"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
            ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
            fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
            deserunt mollit anim id est laborum."</p>
    </div>
</section>

<section class="searchbar" id="searchbar">
    <div class="search">
        <h1>Search</h1>
        <form action="/" method="post" class="search-bar">
            <input type="text" placeholder="Search by name, phone, email, etc." name="query">
            <button type="submit"><img src="static/images/search.png"></button>
        </form>
    </div>
    <div class="table">
       {% if customers %}
        <table border="1">
            <thead>
                <tr>
                    <th>Customer ID</th>
                    <th>First Name</th>
                    <th>Last Name</th>
                    <th>Phone</th>
                    <th>Email</th>
                    <th>Street</th>
                    <th>City</th>
                    <th>State</th>
                    <th>Zipcode</th>
                </tr>
            </thead>
            <tbody>
                {% for customer in customers %}
                <tr class="customer-row" data-customer-id="{{ customer[0] }}">
                    <td>{{ customer[0] }}</td>
                    <td>{{ customer[1] }}</td>
                    <td>{{ customer[2] }}</td>
                    <td>{{ customer[3] }}</td>
                    <td>{{ customer[4] }}</td>
                    <td>{{ customer[5] }}</td>
                    <td>{{ customer[6] }}</td>
                    <td>{{ customer[7] }}</td>
                    <td>{{ customer[8] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p>No customers found.</p>
        {% endif %}
    </div>

    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <table id="pastOrdersTable">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Order Status</th>
                        <th>Order Date</th>
                        <th>Required Date</th>
                        <th>Shipped Date</th>
                        <th>Product ID</th>
                        <th>Product Name</th>
                        <th>Model Year</th>
                        <th>Product List Price</th>
                        <th>Brand Name</th>
                        <th>Category Name</th>
                    </tr>
                </thead>
                <tbody id="orderRows">
                    <!-- Table body will be populated dynamically -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Get the modal
        var modal = document.getElementById("myModal");

        // Get the <span> element that closes the modal
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks on <span> (x), close the modal
        span.onclick = function() {
            modal.style.display = "none";
        }

        // Function to show the past orders pop-up window
        function showPastOrders(customerId) {
            var url = '/get_past_orders?customer_id=' + customerId;
            console.log('Fetching data from:', url);
            fetch(url)
                .then(response => {
                    console.log("Response received from server:", response); // Log the response object
                    return response.json(); // Convert response to JSON
                })
                .then(data => {
                    console.log("Data received from server:", data);
                    console.log('Data received:', data); // Log the received data
                    // Populate past orders table with data
                    var table = document.getElementById("pastOrdersTable");
                    table.innerHTML = ""; // Clear previous data

                    // Add table header
                    var headerRow = table.insertRow();
                    headerRow.innerHTML = "<th>Order ID</th><th>Order Status</th><th>Order Date</th><th>Required Date</th><th>Shipped Date</th><th>Product ID</th><th>Product Name</th><th>Model Year</th><th>Product List Price</th><th>Brand Name</th><th>Category Name</th>";

                    console.log("Data received from server:", data);
                    console.log("Data length:", data.length); // Check the length of the data array

                    // Add table rows
                    console.log("Entering forEach loop");
                    data.forEach(order => {
                        console.log("Order object:", order); // Log the entire order object
                        console.log("Order ID:", order.order_id);
                        console.log("Order Status:", order.order_status);
                        var row = table.insertRow();
                        row.insertCell(0).innerHTML = order.order_id;
                        row.insertCell(1).innerHTML = order.order_status;
                        row.insertCell(2).innerHTML = order.order_date;
                        row.insertCell(3).innerHTML = order.required_date;
                        row.insertCell(4).innerHTML = order.shipped_date;
                        row.insertCell(5).innerHTML = order.product_id;
                        row.insertCell(6).innerHTML = order.product_name;
                        row.insertCell(7).innerHTML = order.model_year;
                        row.insertCell(8).innerHTML = order.product_list_price;
                        row.insertCell(9).innerHTML = order.brand_name;
                        row.insertCell(10).innerHTML = order.category_name;
                    });

                    // Display the pop-up window
                    modal.style.display = "block";
                })
                .catch(error => {
                    console.error('Error fetching past orders:', error);
                });
        }
        // Get all customer rows
        var customerRows = document.querySelectorAll('.customer-row');

        // Attach click event listener to each customer row
        customerRows.forEach(row => {
            console.log("Event listener attached to customer row:", row);
            row.addEventListener('click', function() {
                // Get customer ID from data attribute
                var customerId = row.getAttribute('data-customer-id');
                console.log("showPastOrders function called for customer ID:", customerId);
                // Call showPastOrders with customer ID
                showPastOrders(customerId);
            });
        });
    </script>
</section>

<section class="explanation" id="explanation">
    <div class="content">
        <h2>HOW IT ALL WORKS</h2>
        <p>"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et
            dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip
            ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu
            fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia
            deserunt mollit anim id est laborum."</p>
    </div>
</section>


</body>
</html>